<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <title>Control bar</title>
  </head>

  <style>
    body {
      margin: 2px;
    }

    .btn-group button {
      background-color: #4CAF50; /* Green background */
      border: 1px solid green; /* Green border */
      color: white; /* White text */
      padding: 4px 4px; /* Some padding */
      cursor: pointer; /* Pointer/hand icon */
      width: 100%; /* Set a width if needed */
      display: block; /* Make the buttons appear below each other */
    }

    .btn-group button:not(:last-child) {
      border-bottom: none; /* Prevent double borders */
    }

    /* Add a background color on hover */
    .btn-group button:hover {
      background-color: #3e8e41;
    }
  </style>

  <body>
     <div class="btn-group" id="btns"></div>
  </body>

  <script type="module">

     import { connectWebWindow } from './jsrootsys/modules/webwindow.mjs';

     let conn_handle = null;

     function sendMsg(txt) {
       if (conn_handle)
          conn_handle.send(txt);
     }

     function addButton(text, title, id) {
        let btn = document.createElement('button');
        if (id !== undefined)
           btn.onclick = sendMsg.bind(null, `CLICK:${id}`);
        btn.title = title;
        btn.innerHTML = text;
        document.getElementById("btns").appendChild(btn);
     }

     addButton('init', 'Just dummy button until connection established');

     connectWebWindow({
       receiver: {
          // method called when connection to server is established
          onWebsocketOpened(handle) {
             conn_handle = handle;
          },

          onWebsocketMsg(handle, msg) {
             console.log('msg', msg);
             if (msg.slice(0,5) == 'BTNS:') {
                document.getElementById("btns").innerHTML = '';
                let arr = JSON.parse(msg.slice(5));
                for (let n = 0; n < arr.length; n += 2)
                   addButton(arr[n], arr[n+1], n/2);
             }
          },

          // method called when connection is gone
          onWebsocketClosed(handle) {
             conn_handle = null;
             // when connection closed, close panel as well
             if (window) window.close();
          }
       }
    });

  </script>

</html>
